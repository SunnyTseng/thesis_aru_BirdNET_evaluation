mutate(category_dbl = (from + to)/2) %>%
select(common_name, scientific_name, category_dbl, rate)
coul <- brewer.pal(12, "Paired")
coul <- colorRampPalette(coul)(19)
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
ylim(0, 1) +
xlim(0, 1) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom")
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
ylim(0, 1) +
xlim(0, 1) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
ylim(0, 1) +
xlim(0.1, 1) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
ylim(0, 1) +
xlim(0.15, 0.9) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
ylim(0, 1) +
xlim(0.1, 1) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
guides(colour = guide_legend(ncol = 4)) +
plot.margin = margin(1, 1, 1, 1, "cm")
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1, 1, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1, 1, 1.5, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1, 1.5, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1.2, 1, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1, 1, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1.5, 1, 1, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1, 1, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
g
?ggsave()
g <- ggplot(rate, aes(x = category_dbl,
y = rate,
group = common_name,
colour = common_name)) +
geom_point(size = 3,
alpha = 0.2) +
geom_line(stat = "smooth",
method = "loess", # span is 0.75 by default
se = FALSE,
size = 1.5,
alpha = 0.7) +
scale_colour_manual(values = coul) +
scale_x_continuous(limits = c(0.1, 1), expand = c(0, 0)) +
scale_y_continuous(limits = c(0, 1)) +
theme_bw() +
labs(x = "BirdNET confidence",
y = "Proportion of true positive",
colour = "Species") +
theme(axis.title = element_text(size = 16),
axis.text = element_text(size = 12),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.position = "bottom",
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
plot.margin = margin(1, 1, 1, 1, "cm")) +
guides(colour = guide_legend(ncol = 4))
ggsave(plot = g,
filename = here("docs", "figures", "calibration_curves.PNG"),
width = 16,
height = 20,
units = "cm",
dpi = 300)
ggsave(plot = g,
filename = here("docs", "figures", "calibration_curves.PNG"),
width = 28,
height = 20,
units = "cm",
dpi = 300)
data_validation
data_validation %>%
group_nest(common_name, scientific_name, category) %>%
mutate(rate = map_dbl(.x = data, .f =~ sum(.x$observed == "Y")/nrow(.x))) %>%
separate(col = category, into = c("from", "to"), sep = ",")
data_validation %>%
group_nest(common_name, scientific_name, category) %>%
mutate(rate = map_dbl(.x = data, .f =~ sum(.x$observed == "Y")/nrow(.x))) %>%
separate(col = category, into = c("from", "to"), sep = ",") %>%
mutate(from = str_extract(from, pattern = "[^\\(]+") %>% as.numeric(),
to = str_extract(to, pattern = "[^\\]]+") %>% as.numeric()) %>%
mutate(category_dbl = (from + to)/2)
rate_loess <- data_validation %>%
group_nest(common_name, scientific_name, category) %>%
mutate(rate = map_dbl(.x = data, .f =~ sum(.x$observed == "Y")/nrow(.x))) %>%
separate(col = category, into = c("from", "to"), sep = ",") %>%
mutate(from = str_extract(from, pattern = "[^\\(]+") %>% as.numeric(),
to = str_extract(to, pattern = "[^\\]]+") %>% as.numeric()) %>%
mutate(category_dbl = (from + to)/2) %>%
group_nest(common_name) %>%
mutate(rate_loess = map(.x = data, .f =~ loess(rate ~ category_dbl, data = .x) %>%
predict() %>%
ifelse(. > 1, 1, .))) %>%
unnest(cols = c(data, rate_loess)) %>%
select(common_name, scientific_name, category_dbl, rate_loess)
rate_loess_count <- data_all %>%
count(common_name, scientific_name, category) %>%
separate(col = category, into = c("from", "to"), sep = ",") %>%
mutate(from = str_extract(from, pattern = "[^\\(]+") %>% as.numeric(),
to = str_extract(to, pattern = "[^\\]]+") %>% as.numeric()) %>%
mutate(category_dbl = (from + to)/2) %>%
left_join(rate_loess) %>%
drop_na(rate_loess) %>%
mutate(TP = n * rate_loess,
FP = n * (1 - rate_loess)) %>%
group_by(common_name) %>%
mutate(TP_cum = revcumsum(TP)/sum(n)*100,
FP_cum = revcumsum(FP)/sum(n)*100)
